<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Theme - Scripture Scribbles</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Avenir', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
            padding-bottom: 40px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #ddd;
        }

        .back-btn {
            background: none;
            border: none;
            color: #333;
            font-size: 1.5em;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover {
            background: #e0e0e0;
        }

        h1 {
            font-size: 1.5em;
            font-weight: 600;
        }

        .current-theme {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 24px;
        }

        .theme-group {
            margin-bottom: 32px;
        }

        .theme-group h2 {
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
            margin-bottom: 16px;
        }

        .theme-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .theme-card {
            border: 2px solid #ddd;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .theme-card:hover {
            border-color: #FFAD26;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .theme-card.active {
            border-color: #FFAD26;
            border-width: 3px;
        }

        .theme-header {
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .theme-name {
            font-weight: 600;
            font-size: 1em;
        }

        .theme-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FFAD26;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .theme-card.active .theme-check {
            display: flex;
        }

        .theme-preview {
            padding: 16px;
        }

        /* Preview elements */
        .preview-highlights {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .preview-highlight {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 500;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .preview-highlights-row2 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }

        .preview-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .preview-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .preview-verses {
            margin-bottom: 12px;
        }

        .preview-verse {
            display: flex;
            gap: 8px;
            padding: 6px 0;
            font-size: 0.8em;
            line-height: 1.4;
        }

        .preview-verse-num {
            font-weight: 600;
            opacity: 0.6;
            flex-shrink: 0;
            width: 16px;
        }

        .preview-verse-text {
            flex: 1;
        }

        .preview-verse-tag {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
            margin-left: 6px;
            white-space: nowrap;
        }

        @media (max-width: 600px) {
            .preview-highlights,
            .preview-highlights-row2 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="goBack()" aria-label="Go back">
                <i class="ph ph-arrow-left"></i>
            </button>
            <h1>Choose Theme</h1>
        </div>

        <p class="current-theme">Current theme: <strong id="current-theme-name">Clean</strong></p>

        <div id="theme-container"></div>
    </div>

    <script>
        // Theme definitions with all colours
        const themes = {
            // WCAG AAA
            'high-contrast-light': {
                name: 'High Contrast Light',
                group: 'wcag',
                bg: '#FFFFFF',
                bgSecondary: '#F5F5F5',
                text: '#000000',
                highlights: ['#0052CC', '#006644', '#CC0000', '#5243AA', '#B35900', '#A3006B'],
                tags: ['#0052CC', '#006644', '#CC0000', '#5243AA', '#B35900', '#A3006B']
            },
            'high-contrast-dark': {
                name: 'High Contrast Dark',
                group: 'wcag',
                bg: '#0A0A0A',
                bgSecondary: '#1A1A1A',
                text: '#FFFFFF',
                highlights: ['#4DA6FF', '#4ADE80', '#FF6B6B', '#A78BFA', '#FFB347', '#FF8FAB'],
                tags: ['#4DA6FF', '#4ADE80', '#FF6B6B', '#A78BFA', '#FFB347', '#FF8FAB']
            },
            // Accessibility
            'dyslexia-light': {
                name: 'Dyslexia Light',
                group: 'accessibility',
                bg: '#FFF8F0',
                bgSecondary: '#F5EDE3',
                text: '#1A1A1A',
                highlights: ['#0077B6', '#2D6A4F', '#C1121F', '#7B2CBF', '#F77F00', '#D62828'],
                tags: ['#0077B6', '#2D6A4F', '#C1121F', '#7B2CBF', '#F77F00', '#D62828']
            },
            'dyslexia-dark': {
                name: 'Dyslexia Dark',
                group: 'accessibility',
                bg: '#1A1A2E',
                bgSecondary: '#16213E',
                text: '#FFFACD',
                highlights: ['#FDE047', '#86EFAC', '#60A5FA', '#C084FC', '#FDBA74', '#F472B6'],
                tags: ['#FDE047', '#86EFAC', '#60A5FA', '#C084FC', '#FDBA74', '#F472B6']
            },
            'github-light': {
                name: 'Github Light',
                group: 'accessibility',
                bg: '#FFFFFF',
                bgSecondary: '#F6F8FA',
                text: '#24292E',
                highlights: ['#0366D6', '#28A745', '#D73A49', '#005CC5', '#FFAB70', '#F97583'],
                tags: ['#0366D6', '#28A745', '#D73A49', '#005CC5', '#FFAB70', '#F97583']
            },
            'github-dark': {
                name: 'Github Dark',
                group: 'accessibility',
                bg: '#0D1117',
                bgSecondary: '#161B22',
                text: '#C9D1D9',
                highlights: ['#58A6FF', '#3FB950', '#F85149', '#388BFD', '#FFA657', '#FF7B72'],
                tags: ['#58A6FF', '#3FB950', '#F85149', '#388BFD', '#FFA657', '#FF7B72']
            },
            'paper': {
                name: 'Paper',
                group: 'accessibility',
                bg: '#FDFCFB',
                bgSecondary: '#F5F3F0',
                text: '#2D2D2D',
                highlights: ['#1E3A5F', '#2E7D32', '#C62828', '#6A1B9A', '#E65100', '#AD1457'],
                tags: ['#1E3A5F', '#2E7D32', '#C62828', '#6A1B9A', '#E65100', '#AD1457']
            },
            // Light
            'clean': {
                name: 'Clean',
                group: 'light',
                bg: '#FFFFFF',
                bgSecondary: '#EFEFF4',
                text: '#000000',
                highlights: ['#FFD93D', '#6BCF7F', '#4A90E2', '#FF6B9D', '#9B6BDB', '#FF8C42'],
                tags: ['#FFD93D', '#6BCF7F', '#4A90E2', '#FF6B9D', '#9B6BDB', '#FF8C42']
            },
            'warm': {
                name: 'Warm',
                group: 'light',
                bg: '#FFF8F0',
                bgSecondary: '#F5E6D3',
                text: '#2C1810',
                highlights: ['#F4A261', '#84A98C', '#8FA7D4', '#DE7C93', '#B29BD3', '#E76F51'],
                tags: ['#F4A261', '#84A98C', '#8FA7D4', '#DE7C93', '#B29BD3', '#E76F51']
            },
            'gruvbox-light': {
                name: 'Gruvbox Light',
                group: 'light',
                bg: '#F9F5E8',
                bgSecondary: '#F2EBD9',
                text: '#3C3836',
                highlights: ['#D65D0E', '#98971A', '#CC241D', '#458588', '#FE8019', '#B16286'],
                tags: ['#D65D0E', '#98971A', '#CC241D', '#458588', '#FE8019', '#B16286']
            },
            // Dark
            'true-dark': {
                name: 'True Dark',
                group: 'dark',
                bg: '#000000',
                bgSecondary: '#1A1A1A',
                text: '#FFFFFF',
                highlights: ['#FFD93D', '#6BCF7F', '#4A90E2', '#FF6B9D', '#9B6BDB', '#FF8C42'],
                tags: ['#FFD93D', '#6BCF7F', '#4A90E2', '#FF6B9D', '#9B6BDB', '#FF8C42']
            },
            'slate': {
                name: 'Slate',
                group: 'dark',
                bg: '#1E1E1E',
                bgSecondary: '#2D2D2D',
                text: '#E8E8E8',
                highlights: ['#D4AF37', '#5FA67F', '#5B7C99', '#C56B80', '#8B7BA8', '#D17948'],
                tags: ['#D4AF37', '#5FA67F', '#5B7C99', '#C56B80', '#8B7BA8', '#D17948']
            },
            'nord': {
                name: 'Nord',
                group: 'dark',
                bg: '#2E3440',
                bgSecondary: '#3B4252',
                text: '#ECEFF4',
                highlights: ['#88C0D0', '#A3BE8C', '#BF616A', '#81A1C1', '#D08770', '#BF616A'],
                tags: ['#88C0D0', '#A3BE8C', '#BF616A', '#81A1C1', '#D08770', '#BF616A']
            },
            'gruvbox-dark': {
                name: 'Gruvbox Dark',
                group: 'dark',
                bg: '#282828',
                bgSecondary: '#3C3836',
                text: '#EBDBB2',
                highlights: ['#FABD2F', '#8EC07C', '#FB4934', '#83A598', '#D3869B', '#B16286'],
                tags: ['#FABD2F', '#8EC07C', '#FB4934', '#83A598', '#D3869B', '#B16286']
            },
            'monokai': {
                name: 'Monokai',
                group: 'dark',
                bg: '#272822',
                bgSecondary: '#3E3D32',
                text: '#F8F8F2',
                highlights: ['#AE81FF', '#A6E22E', '#F92672', '#66D9EF', '#FD971F', '#F92672'],
                tags: ['#AE81FF', '#A6E22E', '#F92672', '#66D9EF', '#FD971F', '#F92672']
            },
            'ocean-deep': {
                name: 'Ocean Deep',
                group: 'dark',
                bg: '#0B1C2A',
                bgSecondary: '#1A2B3A',
                text: '#E0F4FF',
                highlights: ['#38BDF8', '#34D399', '#F87171', '#C084FC', '#FBBF24', '#EC4899'],
                tags: ['#38BDF8', '#34D399', '#F87171', '#C084FC', '#FBBF24', '#EC4899']
            },
            'twilight': {
                name: 'Twilight',
                group: 'dark',
                bg: '#282A36',
                bgSecondary: '#383A59',
                text: '#F8F8F2',
                highlights: ['#BD93F9', '#50FA7B', '#FF5555', '#8BE9FD', '#FFB86C', '#FF79C6'],
                tags: ['#BD93F9', '#50FA7B', '#FF5555', '#8BE9FD', '#FFB86C', '#FF79C6']
            },
            'sunset': {
                name: 'Sunset',
                group: 'dark',
                bg: '#2C203D',
                bgSecondary: '#3E2D54',
                text: '#FDE2E4',
                highlights: ['#FF8C42', '#A06CD5', '#F45B69', '#FFD166', '#FFB4A2', '#D8A4E2'],
                tags: ['#FF8C42', '#A06CD5', '#F45B69', '#FFD166', '#FFB4A2', '#D8A4E2']
            },
            'luxury': {
                name: 'Luxury',
                group: 'dark',
                bg: '#1A1A1A',
                bgSecondary: '#2A2A2A',
                text: '#EAEAEA',
                highlights: ['#D4AF37', '#C0C0C0', '#A42A2A', '#8A7967', '#B48A3A', '#A44A4A'],
                tags: ['#D4AF37', '#C0C0C0', '#A42A2A', '#8A7967', '#B48A3A', '#A44A4A']
            }
        };

        const groups = {
            'wcag': 'High Contrast (WCAG AAA)',
            'accessibility': 'Accessibility Focused',
            'light': 'Light Themes',
            'dark': 'Dark Themes'
        };

        // Get contrasting text colour
        function getContrastText(bgColor) {
            const hex = bgColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
        }

        // Render theme card
        function renderThemeCard(id, theme) {
            const highlights = theme.highlights;
            const tags = theme.tags;

            return `
                <div class="theme-card" data-theme="${id}">
                    <div class="theme-header">
                        <span class="theme-name">${theme.name}</span>
                        <div class="theme-check"><i class="ph ph-check"></i></div>
                    </div>
                    <div class="theme-preview" style="background: ${theme.bg}">
                        <div class="preview-verses">
                            <div class="preview-verse" style="background: ${highlights[0]}; color: ${getContrastText(highlights[0])}; padding: 6px 8px; border-radius: 4px;">
                                <span class="preview-verse-num">1</span>
                                <span class="preview-verse-text">In the beginning God created the heavens and the earth.</span>
                            </div>
                            <div class="preview-verse" style="color: ${theme.text}">
                                <span class="preview-verse-num">2</span>
                                <span class="preview-verse-text">The earth was formless and empty.<span class="preview-verse-tag" style="background: ${tags[1]}; color: ${getContrastText(tags[1])}">Creation</span></span>
                            </div>
                            <div class="preview-verse" style="color: ${theme.text}">
                                <span class="preview-verse-num">3</span>
                                <span class="preview-verse-text">God said, "Let there be light," and there was light.</span>
                            </div>
                        </div>
                        <div class="preview-highlights">
                            <div class="preview-highlight" style="background: ${highlights[0]}; color: ${getContrastText(highlights[0])}">H1</div>
                            <div class="preview-highlight" style="background: ${highlights[1]}; color: ${getContrastText(highlights[1])}">H2</div>
                            <div class="preview-highlight" style="background: ${highlights[2]}; color: ${getContrastText(highlights[2])}">H3</div>
                            <div class="preview-highlight" style="background: ${highlights[3]}; color: ${getContrastText(highlights[3])}">H4</div>
                        </div>
                        <div class="preview-highlights-row2">
                            <div class="preview-highlight" style="background: ${highlights[4]}; color: ${getContrastText(highlights[4])}">H5</div>
                            <div class="preview-highlight" style="background: ${highlights[5]}; color: ${getContrastText(highlights[5])}">H6</div>
                            <div class="preview-highlight" style="background: ${theme.bgSecondary}; color: ${theme.text}">Text</div>
                            <div class="preview-highlight" style="background: ${theme.bgSecondary}; color: ${theme.text}">Text</div>
                        </div>
                        <div class="preview-tags">
                            ${tags.map(color => `<div class="preview-tag" style="background: ${color}; color: ${getContrastText(color)}">Tag</div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // Render all themes
        function renderThemes() {
            const container = document.getElementById('theme-container');
            let html = '';

            // Group themes
            const grouped = {};
            for (const [id, theme] of Object.entries(themes)) {
                if (!grouped[theme.group]) grouped[theme.group] = [];
                grouped[theme.group].push({ id, ...theme });
            }

            // Render groups
            for (const [groupId, groupName] of Object.entries(groups)) {
                if (grouped[groupId] && grouped[groupId].length > 0) {
                    html += `
                        <div class="theme-group">
                            <h2>${groupName}</h2>
                            <div class="theme-list">
                                ${grouped[groupId].map(t => renderThemeCard(t.id, t)).join('')}
                            </div>
                        </div>
                    `;
                }
            }

            container.innerHTML = html;
        }

        // Load current theme
        function loadCurrentTheme() {
            const savedTheme = localStorage.getItem('theme') || 'clean';
            updateActiveTheme(savedTheme);
            const theme = themes[savedTheme];
            document.getElementById('current-theme-name').textContent = theme ? theme.name : savedTheme;
        }

        // Update active state
        function updateActiveTheme(theme) {
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.theme === theme) {
                    card.classList.add('active');
                }
            });
        }

        // Select theme
        function selectTheme(theme) {
            localStorage.setItem('theme', theme);
            updateActiveTheme(theme);
            const themeData = themes[theme];
            document.getElementById('current-theme-name').textContent = themeData ? themeData.name : theme;
        }

        // Go back
        function goBack() {
            const referrer = document.referrer;
            if (referrer && (referrer.includes('scripture-scribbles') || referrer.includes('preview'))) {
                window.history.back();
            } else {
                window.location.href = 'scripture-scribbles-v1.1.html';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderThemes();
            loadCurrentTheme();

            // Add click handlers to theme cards
            document.addEventListener('click', (e) => {
                const card = e.target.closest('.theme-card');
                if (card) {
                    selectTheme(card.dataset.theme);
                }
            });
        });
    </script>
</body>
</html>
